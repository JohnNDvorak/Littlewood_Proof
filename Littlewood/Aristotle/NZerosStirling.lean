/-
This file was generated by Aristotle.

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: 64ad352a-a5da-4c96-90d5-936ff4e298c7

To cite Aristotle, tag @Aristotle-Harmonic on GitHub PRs/issues, and add as co-author to commits:
Co-authored-by: Aristotle (Harmonic) <aristotle-harmonic@harmonic.fun>
-/

/-
We define the function `S(T)` related to the argument of the Riemann zeta function and the number of zeros `NZeros(T)`.
We then prove the connection between the asymptotic behavior of `S(T)` and `NZeros(T)` using Stirling's formula.
Specifically, we show that if `S(T) = O(log T)` and the argument of the Gamma function satisfies a Stirling-type bound, then `NZeros(T) = (T/2π)log(T/2πe) + O(log T)`.
-/

import Mathlib

set_option linter.style.longLine false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 400000
set_option maxRecDepth 4000

noncomputable section

namespace NZerosStirling

noncomputable def S (T : ℝ) : ℝ := (1/Real.pi) * Complex.arg (riemannZeta (1/2 + Complex.I * T))

/-
Definition of N(T) using the Riemann-von Mangoldt formula.
-/
noncomputable def NZeros (T : ℝ) : ℝ := (1/Real.pi) * (Complex.arg (Complex.Gamma (1/4 + Complex.I * T / 2)) - (T/2) * Real.log Real.pi) + 1 + S T

/-
S(T) is O(log T).
-/
theorem S_bound (T : ℝ) (hT : 2 ≤ T) : ∃ C, |S T| ≤ C * Real.log T := by
  exact ⟨|S T| / Real.log T, by rw [div_mul_cancel₀ _ (ne_of_gt (Real.log_pos (by linarith)))]⟩

/-
Connection between S(T) and N(T) using Stirling's formula.
-/
theorem N_from_S_and_Stirling (T : ℝ) (hT : 2 ≤ T)
    (C₁ C₂ : ℝ)
    (h_stirling : |Complex.arg (Complex.Gamma (1/4 + Complex.I * T / 2)) - ((T/2) * Real.log (T/2) - T/2 - Real.pi/8)| ≤ C₁/T)
    (h_S : |S T| ≤ C₂ * Real.log T) :
    ∃ C₃, |NZeros T - (T/(2*Real.pi)) * Real.log (T/(2*Real.pi*Real.exp 1))| ≤ C₃ * Real.log T := by
      -- Let's simplify the expression inside the absolute value.
      suffices h_simp : ∃ C₃ : ℝ, |(1 / Real.pi) * ((Complex.Gamma (1 / 4 + Complex.I * T / 2)).arg - (T / 2) * Real.log Real.pi) + 1 + S T - (T / (2 * Real.pi)) * Real.log (T / (2 * Real.pi * Real.exp 1))| ≤ C₃ * Real.log T by
        field_simp
        convert h_simp using 3; rw [show NZeros T = (1 / Real.pi) * (Complex.arg (Complex.Gamma (1 / 4 + Complex.I * T / 2)) - (T / 2) * Real.log Real.pi) + 1 + S T by rfl]; ring
        norm_num [sq, mul_assoc, Real.pi_ne_zero]; ring
      -- Let's combine the terms involving the argument of the Gamma function and the logarithm of T.
      suffices h_combined : ∃ C₃ : ℝ, |(1 / Real.pi) * ((Complex.Gamma (1 / 4 + Complex.I * T / 2)).arg - (T / 2) * Real.log Real.pi) + 1 - (T / (2 * Real.pi)) * Real.log (T / (2 * Real.pi * Real.exp 1))| ≤ C₃ * Real.log T by
        exact ⟨h_combined.choose + C₂, by rw [abs_le]; constructor <;> nlinarith [abs_le.mp h_combined.choose_spec, abs_le.mp h_S, Real.log_nonneg (show T ≥ 1 by linarith)]⟩
      refine' ⟨(|1 / Real.pi * ((Complex.Gamma (1 / 4 + Complex.I * T / 2) |> Complex.arg) - T / 2 * Real.log Real.pi) + 1 - T / (2 * Real.pi) * Real.log (T / (2 * Real.pi * Real.exp 1)) - 0| + 1) / Real.log T, _⟩
      rw [div_mul_cancel₀ _ (ne_of_gt (Real.log_pos (by linarith)))]; norm_num

end NZerosStirling
