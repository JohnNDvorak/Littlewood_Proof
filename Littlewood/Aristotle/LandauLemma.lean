/-
Landau's Lemma - Generated by Aristotle (Harmonic)
Co-authored-by: Aristotle (Harmonic) <aristotle-harmonic@harmonic.fun>
-/
import Mathlib

set_option maxHeartbeats 400000

open scoped BigOperators Real Nat Classical Pointwise

noncomputable section

theorem partial_sums_mono {a : ℕ → ℝ} (ha : ∀ n, 0 ≤ a n) :
    Monotone (fun N => ∑ n ∈ Finset.range N, a n) :=
  fun n m hnm => Finset.sum_le_sum_of_subset_of_nonneg (Finset.range_mono hnm) fun _ _ _ => ha _

theorem tendsto_atTop_of_nonneg_not_summable
    {a : ℕ → ℝ} (ha : ∀ n, 0 ≤ a n) (hns : ¬ Summable a) :
    Filter.Tendsto (fun N => ∑ n ∈ Finset.range N, a n) Filter.atTop Filter.atTop :=
  not_summable_iff_tendsto_nat_atTop_of_nonneg ha |>.1 hns

theorem dirichlet_series_eq_tsum_real
    (a : ℕ → ℝ) (σ : ℝ)
    (hs : Summable (fun n => a n * (n : ℝ)^(-σ))) :
    (∑' n, (a n : ℂ) * (n : ℂ)^(-(σ : ℂ))).re = ∑' n, a n * (n : ℝ)^(-σ) := by
  -- Per-term: ((a n : ℂ) * (n : ℂ)^(-σ)).re = a n * n^(-σ)
  have hterm : ∀ n, ((a n : ℂ) * (n : ℂ)^(-(σ : ℂ))).re = a n * (n : ℝ)^(-σ) := by
    intro n
    have hn' : (0 : ℝ) ≤ n := by exact_mod_cast Nat.zero_le n
    have key1 : (n : ℂ) = ((n : ℝ) : ℂ) := by norm_cast
    have key2 : (-(σ : ℂ) : ℂ) = ((-σ : ℝ) : ℂ) := (Complex.ofReal_neg σ).symm
    rw [key1, key2, ← Complex.ofReal_cpow hn' (-σ)]
    simp only [← Complex.ofReal_mul, Complex.ofReal_re]
  -- First show the complex series is summable
  have hsc : Summable (fun n => (a n : ℂ) * (n : ℂ)^(-(σ : ℂ))) := by
    apply Summable.of_norm
    have hnorm : ∀ n, ‖(a n : ℂ) * (n : ℂ)^(-(σ : ℂ))‖ = |a n * (n : ℝ)^(-σ)| := by
      intro n
      rw [Complex.norm_mul]
      have hn' : (0 : ℝ) ≤ n := by exact_mod_cast Nat.zero_le n
      have key1 : (n : ℂ) = ((n : ℝ) : ℂ) := by norm_cast
      have key2 : (-(σ : ℂ) : ℂ) = ((-σ : ℝ) : ℂ) := (Complex.ofReal_neg σ).symm
      rw [key1, key2, ← Complex.ofReal_cpow hn' (-σ)]
      rw [Complex.norm_real, Complex.norm_real, Real.norm_eq_abs, Real.norm_eq_abs, abs_mul]
    simp_rw [hnorm]
    exact hs.abs
  -- Now use Complex.re_tsum
  rw [Complex.re_tsum hsc]
  congr 1
  ext n
  exact hterm n

theorem analyticAt_bounded_on_compact
    {f : ℂ → ℂ} {z₀ : ℂ} (hf : AnalyticAt ℂ f z₀) :
    ∃ r > 0, ∃ M, ∀ z, ‖z - z₀‖ ≤ r → ‖f z‖ ≤ M := by
  obtain ⟨δ, hδ_pos, hδ⟩ : ∃ δ > 0, ∀ z, ‖z - z₀‖ < δ → ‖f z - f z₀‖ < 1 := by
    simpa using Metric.continuousAt_iff.mp hf.continuousAt 1 zero_lt_one
  exact ⟨δ / 2, half_pos hδ_pos, ‖f z₀‖ + 1, fun z hz => by
    linarith [norm_sub_norm_le (f z) (f z₀), hδ z (lt_of_le_of_lt hz (by linarith))]⟩

/-! ## Main Landau Theorems -/

/-- As σ → σ_c⁺, the Dirichlet series tends to +∞ for non-negative coefficients
    when the series diverges at σ_c. -/
theorem dirichlet_series_tendsto_atTop
    (a : ℕ → ℝ) (ha : ∀ n, 0 ≤ a n) (σ_c : ℝ)
    (hconv : ∀ σ : ℝ, σ_c < σ → Summable (fun n => a n * (n : ℝ)^(-σ)))
    (hdiv : ¬ Summable (fun n => a n * (n : ℝ)^(-σ_c))) :
    Filter.Tendsto (fun σ => ∑' n, a n * (n : ℝ)^(-σ))
                   (nhdsWithin σ_c (Set.Ioi σ_c)) Filter.atTop := by
  -- BLOCKED: Complex proof requiring:
  -- 1. Monotonicity of partial sums in σ
  -- 2. Filter limit argument for nhdsWithin
  -- 3. Tsum continuity near boundary
  sorry

/-- Landau's Theorem: A Dirichlet series with non-negative coefficients that converges
    for Re(s) > σ_c but diverges at σ_c has a singularity at σ_c on the real axis. -/
theorem landau_dirichlet_singularity
    (a : ℕ → ℝ) (ha_nonneg : ∀ n, 0 ≤ a n) (σ_c : ℝ)
    (hconv : ∀ σ : ℝ, σ_c < σ → Summable (fun n => a n * (n : ℝ)^(-σ)))
    (hdiv : ¬ Summable (fun n => a n * (n : ℝ)^(-σ_c))) :
    ¬ AnalyticAt ℂ (fun s => ∑' n, (a n : ℂ) * (n : ℂ)^(-s)) (σ_c : ℂ) := by
  intro hanalytic
  -- If analytic at σ_c, the function is bounded near σ_c
  obtain ⟨r, hr_pos, M, hM⟩ := analyticAt_bounded_on_compact hanalytic
  -- But on the real axis, the series tends to +∞ as σ → σ_c⁺
  have htends := dirichlet_series_tendsto_atTop a ha_nonneg σ_c hconv hdiv
  -- This contradicts boundedness
  -- BLOCKED: Need to connect complex function on real axis to real tsum
  sorry

end
